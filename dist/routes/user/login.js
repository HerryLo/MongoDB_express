'use strict';

var express = require('express');
var router = express.Router();
var UserModel = require('../../model/UserModel');

var _require = require('../../utils/constant'),
    Sendformat = _require.Sendformat;

var loginCheck = function loginCheck(query, d) {
    var user = query.user;
    var password = query.password;
    if (!d || user != d.user || password != d.password) {
        return { code: 1, desc: '用户名或密码错误' };
    } else {
        return { code: 0, desc: '成功' };
    }
};

router.get('/', function (req, res, next) {
    var cookies = req.cookies;
    var user = req.query.user;
    var password = req.query.password;
    UserModel.findUser({
        user: user,
        password: password
    }).then(function (result) {
        var d = result[0];
        var obj = loginCheck(req.query, d);
        if (obj.code == 0) {
            // let ck = `${new Date().getTime()}&${user}`;
            // res.cookie("cookie", ck, {maxAge: 60 * 1000});
            req.session.JSTOKEN = d._id;
            console.log(user + ':' + req.session[user], req.session);
            res.send({ code: obj.code, desc: obj.desc, data: [] });
        } else {
            res.send({ code: obj.code, desc: obj.desc, data: [] });
        }
    });
});

module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9yb3V0ZXMvdXNlci9sb2dpbi5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIlVzZXJNb2RlbCIsIlNlbmRmb3JtYXQiLCJsb2dpbkNoZWNrIiwicXVlcnkiLCJkIiwidXNlciIsInBhc3N3b3JkIiwiY29kZSIsImRlc2MiLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29va2llcyIsImZpbmRVc2VyIiwidGhlbiIsInJlc3VsdCIsIm9iaiIsInNlc3Npb24iLCJKU1RPS0VOIiwiX2lkIiwiY29uc29sZSIsImxvZyIsInNlbmQiLCJkYXRhIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxVQUFVQyxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNQyxTQUFTRixRQUFRRyxNQUFSLEVBQWY7QUFDQSxJQUFNQyxZQUFZSCxRQUFRLHVCQUFSLENBQWxCOztlQUNxQkEsUUFBUSxzQkFBUixDO0lBQWRJLFUsWUFBQUEsVTs7QUFFUCxJQUFNQyxhQUFhLFNBQWJBLFVBQWEsQ0FBQ0MsS0FBRCxFQUFRQyxDQUFSLEVBQWE7QUFDNUIsUUFBTUMsT0FBT0YsTUFBTUUsSUFBbkI7QUFDQSxRQUFNQyxXQUFXSCxNQUFNRyxRQUF2QjtBQUNBLFFBQUcsQ0FBQ0YsQ0FBRCxJQUFNQyxRQUFRRCxFQUFFQyxJQUFoQixJQUF3QkMsWUFBWUYsRUFBRUUsUUFBekMsRUFBa0Q7QUFDOUMsZUFBTyxFQUFDQyxNQUFNLENBQVAsRUFBVUMsTUFBTSxVQUFoQixFQUFQO0FBQ0gsS0FGRCxNQUVLO0FBQ0QsZUFBTyxFQUFDRCxNQUFNLENBQVAsRUFBU0MsTUFBTSxJQUFmLEVBQVA7QUFDSDtBQUNKLENBUkQ7O0FBVUFWLE9BQU9XLEdBQVAsQ0FBVyxHQUFYLEVBQWdCLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFXQyxJQUFYLEVBQW9CO0FBQ2hDLFFBQU1DLFVBQVVILElBQUlHLE9BQXBCO0FBQ0EsUUFBTVIsT0FBT0ssSUFBSVAsS0FBSixDQUFVRSxJQUF2QjtBQUNBLFFBQU1DLFdBQVdJLElBQUlQLEtBQUosQ0FBVUcsUUFBM0I7QUFDQU4sY0FBVWMsUUFBVixDQUFtQjtBQUNmVCxjQUFNQSxJQURTO0FBRWZDLGtCQUFVQTtBQUZLLEtBQW5CLEVBR0dTLElBSEgsQ0FHUSxVQUFVQyxNQUFWLEVBQWtCO0FBQ3RCLFlBQU1aLElBQUlZLE9BQU8sQ0FBUCxDQUFWO0FBQ0EsWUFBSUMsTUFBTWYsV0FBV1EsSUFBSVAsS0FBZixFQUFzQkMsQ0FBdEIsQ0FBVjtBQUNBLFlBQUlhLElBQUlWLElBQUosSUFBWSxDQUFoQixFQUFtQjtBQUNmO0FBQ0E7QUFDQUcsZ0JBQUlRLE9BQUosQ0FBWUMsT0FBWixHQUFzQmYsRUFBRWdCLEdBQXhCO0FBQ0FDLG9CQUFRQyxHQUFSLENBQVlqQixPQUFLLEdBQUwsR0FBU0ssSUFBSVEsT0FBSixDQUFZYixJQUFaLENBQXJCLEVBQXdDSyxJQUFJUSxPQUE1QztBQUNBUCxnQkFBSVksSUFBSixDQUFTLEVBQUNoQixNQUFNVSxJQUFJVixJQUFYLEVBQWlCQyxNQUFNUyxJQUFJVCxJQUEzQixFQUFpQ2dCLE1BQUssRUFBdEMsRUFBVDtBQUNILFNBTkQsTUFNTztBQUNIYixnQkFBSVksSUFBSixDQUFTLEVBQUNoQixNQUFNVSxJQUFJVixJQUFYLEVBQWlCQyxNQUFNUyxJQUFJVCxJQUEzQixFQUFpQ2dCLE1BQU0sRUFBdkMsRUFBVDtBQUNIO0FBQ0osS0FmRDtBQWdCSCxDQXBCRDs7QUFzQkFDLE9BQU9DLE9BQVAsR0FBaUI1QixNQUFqQiIsImZpbGUiOiJsb2dpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuY29uc3QgVXNlck1vZGVsID0gcmVxdWlyZSgnLi4vLi4vbW9kZWwvVXNlck1vZGVsJylcbmNvbnN0IHtTZW5kZm9ybWF0fSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2NvbnN0YW50JylcblxuY29uc3QgbG9naW5DaGVjayA9IChxdWVyeSwgZCk9PiB7XG4gICAgY29uc3QgdXNlciA9IHF1ZXJ5LnVzZXI7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBxdWVyeS5wYXNzd29yZDtcbiAgICBpZighZCB8fCB1c2VyICE9IGQudXNlciB8fCBwYXNzd29yZCAhPSBkLnBhc3N3b3JkKXtcbiAgICAgICAgcmV0dXJuIHtjb2RlOiAxLCBkZXNjOiAn55So5oi35ZCN5oiW5a+G56CB6ZSZ6K+vJ31cbiAgICB9ZWxzZXtcbiAgICAgICAgcmV0dXJuIHtjb2RlOiAwLGRlc2M6ICfmiJDlip8nfVxuICAgIH1cbn1cblxucm91dGVyLmdldCgnLycsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IGNvb2tpZXMgPSByZXEuY29va2llcztcbiAgICBjb25zdCB1c2VyID0gcmVxLnF1ZXJ5LnVzZXI7XG4gICAgY29uc3QgcGFzc3dvcmQgPSByZXEucXVlcnkucGFzc3dvcmQ7XG4gICAgVXNlck1vZGVsLmZpbmRVc2VyKHtcbiAgICAgICAgdXNlcjogdXNlcixcbiAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IGQgPSByZXN1bHRbMF07XG4gICAgICAgIGxldCBvYmogPSBsb2dpbkNoZWNrKHJlcS5xdWVyeSwgZCk7XG4gICAgICAgIGlmIChvYmouY29kZSA9PSAwKSB7XG4gICAgICAgICAgICAvLyBsZXQgY2sgPSBgJHtuZXcgRGF0ZSgpLmdldFRpbWUoKX0mJHt1c2VyfWA7XG4gICAgICAgICAgICAvLyByZXMuY29va2llKFwiY29va2llXCIsIGNrLCB7bWF4QWdlOiA2MCAqIDEwMDB9KTtcbiAgICAgICAgICAgIHJlcS5zZXNzaW9uLkpTVE9LRU4gPSBkLl9pZDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIrJzonK3JlcS5zZXNzaW9uW3VzZXJdLCByZXEuc2Vzc2lvbik7XG4gICAgICAgICAgICByZXMuc2VuZCh7Y29kZTogb2JqLmNvZGUsIGRlc2M6IG9iai5kZXNjLCBkYXRhOltdfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXMuc2VuZCh7Y29kZTogb2JqLmNvZGUsIGRlc2M6IG9iai5kZXNjLCBkYXRhOiBbXX0pO1xuICAgICAgICB9XG4gICAgfSlcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==